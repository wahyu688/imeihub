server {
    listen 80;
    server_name localhost;

    # Tambahkan ini untuk mengatasi 'upstream sent too big header'
    proxy_buffers 16 8k;
    proxy_buffer_size 16k;
    proxy_busy_buffers_size 16k;
    proxy_buffers_number 64; # Coba nilai yang lebih besar, misal 64
    proxy_headers_hash_bucket_size 128; # Default 64, coba 128 atau 256
    proxy_headers_hash_max_size 1024; # Default 512, coba 1024

    # Untuk mengatasi worker_connections warning
    worker_rlimit_nofile 8192; # Meningkatkan batas file
    events {
        worker_connections 4096; # Tingkatkan dari 1024 menjadi 4096
    }

    # Bagian ini dihapus karena komunikasi backend ke Discord bot tidak perlu melewati frontend Nginx.
    # Backend utama Anda akan langsung memanggil API bot Discord.
    # location /api/discord-bot-notify {
    #    proxy_pass https://your-discord-bot-app.dokploy.com/api/discord-bot-notify;
    #    proxy_set_header Host $host;
    #    proxy_set_header X-Real-IP $remote_addr;
    #    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #    proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # Optional: Proxy to Discord Bot commands (jika Anda ingin frontend mengakses endpoint bot secara langsung)
    # Ini tidak diperlukan jika bot hanya dipanggil oleh backend.
    # location /discord-commands {
    #     proxy_pass http://discord_bot:3001; # Ini untuk komunikasi antar kontainer, bukan publik
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    error_page 404 /404.html; # Opsional
    location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html; # Opsional
    location = /50x.html {
    }
}